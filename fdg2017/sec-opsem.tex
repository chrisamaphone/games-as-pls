\newcommand{\Player}[4]{\ensuremath{{#1}{:}\left<{#2},{#3},{#4}\right>}}
\newcommand{\PropIsTrue}[2]{\ensuremath{#1 \vdash #2~\textsf{true}}}
\newcommand{\StepsTo}[4]{\ensuremath{\left<{#1};{#2}\right> \longrightarrow \left<{#3};{#4}\right>}}

\section{Precise player-game dynamics via operational semantics}
\label{sec:opsem}

%The player consists of a 

%The operational semantics employs notions of the game and player states.

%The following BNF definitions give meta variable conventions (the left-hand-side variable names) and syntactic cases (the right-hand-side of each rule).

\begin{figure*}
\small

\begin{tabular}{l|l}

\begin{minipage}{0.68\textwidth}
\begin{tabular}{lccll}
unique IDs & $i,j$ & $::=$ & $\cdots$ & (\emph{abstract}, e.g., numbers, symbols, noun phrases)
\\
propositions   & $P$ & $::=$ & $\cdots$ & Game world propositions~(See~$\PropIsTrue{G}{P}$)
\\
player command & $C$ & $::=$ & $\cdot$ $~|~$ $c$ & Unit and atomic commands (0 and 1 turns, resp.)
\\
               &     & $~|~$ & $C_1~{;}~C_2$ & Command sequences (multi-turn commands)
\\
               &     & $~|~$ & $\textsf{until}~P~\textsf{do}~C$ & Command loops (e.g., for player skills)
\\
atomic command & $c$ & $::=$ & $\textsf{grasp}~i$ & Attempt to place object~$i$ into player's hand
\\
               &     & $|$   & $\textsf{drop}$ & Drop the held object, if any
\\
               &     & $|$   & $\textsf{giveTo}~i$ & Give held object to another~(named~$i$)
\\
               &     & $|$   & $\textsf{takeFrom}~i$ & Take hold of object from another~(named~$i$)
\\
               &     & $|$   & $\textsf{moveTo}~i$ & Move adjacent to object, place or agent~(named~$i$)
\\
               &     & $|$   & $\textsf{moveThrough}~i$ & Move through opening~(named~$i$)
\\[5mm]
\end{tabular}
\begin{tabular}{lccll}
game state & $G$ & $::=$ & $\cdots$ & (\emph{abstract})
\\
player state & $p$ & $::=$ & $\Player{i}{B}{h}{C}$ & Player identity~$i$, bag~$B$, hand~$h$ and commands~$C$
\\
bag state (spaces) & $B,S$ & $::=$ & $\cdot~|~s::S$ & Zero or more unit spaces
\\
hand state (unit space) & $h,s$ & $::=$ & $\square~|~i$ & An empty space, or an object~(named~$i$)
\\
\end{tabular}
\end{minipage}

&

\begin{minipage}{0.3\textwidth}
\[
\begin{array}{ll}
\fbox{$G_1 \equiv G_2$}~\textrm{World equivalence}
\\
\fbox{$B_1 \equiv B_2$}~\textrm{Bag equivalence}
\\
\fbox{$\PropIsTrue{G}{P}$} 
\\
\textrm{In world~$G$, proposition~$P$ is true}.
\\[2mm]
\fbox{$\StepsTo{G}{p}{G'}{p'}$}
\\[2mm]
\infer{  
  \StepsTo
      {G}{ 
        \Player{i}{B_1}{\square}{\textsf{grasp}~j}
      }
      {G}{ 
        \Player{i}{B_2}{j}{\cdot}        
      }
}
{
  B_1 \equiv j :: B_2
}
\\[2mm]
\infer{  
  \StepsTo
      {G}{ 
        \Player{i}{B_1}{j}{\textsf{grasp}~k}
      }
      {G}{ 
        \Player{i}{B_3}{j}{k}{\cdot}
      }
}
{
  B_1 \equiv k :: B_2
  \\
  B_3 \equiv j :: B_2
}
\\[2mm]
\infer{  
  \StepsTo
      {G}{ 
        \Player{i}{B_1}{j}{\textsf{grasp}~k}
      }
      {G}{ 
        \Player{i}{B_3}{j}{k}{\cdot}
      }
}
{
  B_1 \not\equiv k :: B_2
  \\
  B_3 \not\equiv j :: B_2
}
\end{array}
\]
\end{minipage}


\end{tabular}

\[
\begin{array}{l}
\\[2mm]
\infer{  
  \StepsTo
      {G}{ 
        \Player{i}{B}{k}{\textsf{grasp}~k}
      }
      {G}{ 
        \Player{i}{B}{k}{\textsf{errMsg}~\textrm{``you are already holding $k$''}}
      }
}
{
\quad
}
\\[2mm]
\infer{
  \StepsTo
      {G_1}{
        \Player{i}{B_1}{j}{\textsf{drop}}
      }
      {G_2}{
        \Player{i}{B_3}{\square}{\cdot}
      }
}
{
  G_2 \equiv \textsf{dropItem}(G_1, j, \textsf{pos}(i))
}
\\[2mm]
\infer{
  \StepsTo
      {G_1}{
        \Player{i}{B}{k}{\textsf{giveTo}~j}
      }
      {G_2}{
        \Player{i}{B}{\square}{\cdot}
      }
}
{
  G_1\,{\vdash}\,\textsf{isNear}(i, j)
  \\
  G_2 \equiv \textsf{giveItemTo}(G_1, k, j)
}
\end{array}
\]


\caption{Definitions for an operational semantics: Captures precise
  player-game dynamics for a primitive adventure game.}
\end{figure*}
